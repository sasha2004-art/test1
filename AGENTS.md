# AI_AGENT.md: AI Quest Generator

## 1. Миссия

Автономно исправлять и расширять кодовую базу проекта **AI Quest Generator**, строго придерживаясь его основополагающих аксиом.

## 2. Аксиомы (Основные Принципы)

Перед началом любой работы изучите и примите эти аксиомы. Они являются законом.

*   **A1: Корректность, доказанная тестами и типами.** Любые изменения должны проходить все тесты. Весь новый код должен быть типизирован.
*   **A2: Читаемость за ≤ 60 секунд.** Код должен быть интуитивно понятным для других разработчиков.
*   **A3: Единый источник истины.** Избегайте дублирования кода и конфигураций. Используйте переменные окружения.
*   **A4: Быстрое и громкое падение.** Ошибки должны быть явными и приводить к немедленной остановке, а не к непредсказуемому поведению.
*   **A5: Маленькие, сфокусированные единицы.** Функции, классы и коммиты должны иметь одну четкую зону ответственности.
*   **A6: Чистое ядро, нечистые границы.** Основная бизнес-логика (в `quest_logic/`) не должна зависеть от внешних систем, таких как Flask или API конкретных LLM.
*   **A7: Детерминированные сборки.** Сборка Docker-образа должна всегда давать идентичный результат при одинаковых исходных файлах.
*   **A8: Непрерывная проверка.** Всегда запускайте скрипт верификации `./scripts/verify.sh` перед созданием коммита.
*   **A9: Безопасные значения по умолчанию.** Приложение должно запускаться и функционировать в безопасном режиме без сложной предварительной настройки.
*   **A10: Контроль версий всего.** Код, документация (`@docs/`) и данный файл (`AI_AGENT.md`) находятся под управлением Git.

## 3. Цикл Рабочего Процесса и Правила Взаимодействия

### 3.1. Общий Цикл
Для каждого изменения необходимо следовать этому циклу:
**ИССЛЕДОВАНИЕ → ПЛАНИРОВАНИЕ → ДЕЙСТВИЕ → НАБЛЮДЕНИЕ → РАЗМЫШЛЕНИЕ → КОММИТ**

### 3.2. Работа с Git
*   **Работайте в отдельных ветках.** Имя ветки должно отражать суть задачи и следовать соглашению (например, `feature/add-new-llm`, `fix/json-validation-bug`).
*   **Коммитьте свои изменения.** Используйте `git commit` для фиксации атомарных изменений. Оцениваться будет только закоммиченный код.
*   **Исправляйте ошибки pre-commit.** Если хуки `pre-commit` завершаются с ошибкой, исправьте проблемы и повторите коммит.
*   **Поддерживайте чистоту рабочей директории.** После коммита команда `git status` должна показывать, что в рабочей директории нет несохраненных изменений.
*   **Не изменяйте существующие коммиты.** Не используйте команды `git commit --amend` или `git rebase`.

### 3.3. Интерпретация `AGENTS.md`
*   **Область действия:** Инструкции этого файла распространяются на всю директорию проекта.
*   **Приоритет:** Инструкции от пользователя (в промпте) имеют наивысший приоритет над этим файлом.
*   **Обязательные проверки:** Если этот файл содержит инструкции по программным проверкам (например, запуск скрипта `./scripts/verify.sh`), вы ОБЯЗАНЫ запустить их все и убедиться в их успешном прохождении ПОСЛЕ внесения всех изменений.

### 3.4. Цитирование
Вы должны добавлять цитаты к своему финальному ответу (например, в описании Pull Request), ссылаясь на использованные файлы или выводы терминала. **Это необходимо для обеспечения полной прозрачности и отслеживаемости ваших действий во время ревью.**

*   **Формат для файлов:** `【F:<file_path>†L<line_start>(-L<line_end>)?】`
    *   *Пример:* Этот код инициализирует Flask-приложение【F:backend/app.py†L10】.
*   **Формат для терминала:** `【<chunk_id>†L<line_start>(-L<line_end>)?】`
    *   *Пример:* Все тесты успешно пройдены【terminal_output_1†L5】.

## 4. Настройка и Исследование Среды

### 4.1. Настройка Среды Выполнения
1.  **Определите основной язык:** Python. Файл зависимостей — `requirements.txt`.
2.  **Настройте окружение:** Скопируйте `cp .env.example .env` и внесите необходимые API-ключи. Секреты не должны попадать в Git.
3.  **Запустите среду:** Проект полностью контейнеризован. Используйте `docker-compose up --build -d` для запуска. Веб-интерфейс будет доступен по адресу `http://localhost:5000`.

### 4.2. Исследование и Отображение (Выполнить до Планирования)
1.  **Инвентаризация:** Используйте `ls -1` и `tree -L 2` для общего обзора структуры.
2.  **Точки входа:** Найдите маршруты Flask с помощью `rg --type py '@app.route' backend/`.
3.  **Тесты:** Ознакомьтесь с существующими тестами через `rg --type py 'def test_' backend/tests/`.
4.  **Архитектурные маркеры:** Изучите `docker-compose.yml`, `Dockerfile`, `backend/app.py` и, что особенно важно, **`@docs/JSON_STRUCTURE.md`**, так как он определяет контракт данных.
5.  **Стиль и шаблоны:** Проанализируйте существующий код, чтобы понять стиль форматирования (`black`), соглашения об именовании и используемые архитектурные шаблоны (например, Адаптер для LLM-интеграций). Ваши изменения должны быть неотличимы от остального кода.

## 5. Контрольный Список Верификации (Обязательная Проверка)

Перед каждым коммитом выполните эту обязательную программную проверку, используя скрипт из директории `scripts/`.

**Создайте файл `./scripts/verify.sh` со следующим содержимым:**
```bash
#!/bin/bash
set -e # Выход при первой ошибке

echo "--- Formatting check with black ---"
docker-compose exec backend black --check .

echo "--- Linting with flake8 ---"
docker-compose exec backend flake8 .

echo "--- Running tests with pytest ---"
docker-compose exec backend pytest

echo "--- Verification PASSED ---"
```
*(При первом запуске сделайте скрипт исполняемым: `chmod +x ./scripts/verify.sh`)*

**Запустите полную проверку:**
```bash
./scripts/verify.sh
```

**Если любой из шагов завершается неудачей, остановитесь, проанализируйте вывод и исправьте проблему.** Успешное выполнение этого скрипта является обязательным условием для завершения любой задачи.