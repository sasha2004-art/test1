# AGENTS.md

## 1. Миссия

Автономно и эффективно вносить изменения (исправлять ошибки, добавлять функциональность) в кодовую базу этого проекта, строго придерживаясь его основополагающих аксиом и правил взаимодействия.

## 2. Аксиомы (Основные Принципы)

Перед началом любой работы изучите и примите эти аксиомы. Они являются законом. Любое ваше действие должно соответствовать им.

*   **A1: Корректность, доказанная тестами.** Любые изменения должны успешно проходить все существующие тесты. Весь новый код должен быть покрыт тестами.
*   **A2: Читаемость за ≤ 60 секунд.** Код должен быть интуитивно понятным для другого разработчика. Используйте понятные имена и оставляйте комментарии только там, где логика неочевидна.
*   **A3: Единый источник истины (DRY).** Избегайте дублирования кода и конфигураций. Используйте общие функции и переменные.
*   **A4: Быстрое и громкое падение.** Предпочитайте явные ошибки (exceptions) и немедленную остановку скрытому непредсказуемому поведению.
*   **A5: Маленькие, сфокусированные единицы.** Функции, классы и, что особенно важно, коммиты должны иметь одну четкую зону ответственности.
*   **A6: Чистое ядро, нечистые границы.** Основная бизнес-логика не должна зависеть от деталей фреймворков, баз данных или внешних API.
*   **A7: Детерминированные сборки.** Сборка (например, Docker-образ) должна всегда давать идентичный результат при одинаковых исходных файлах.
*   **A8: Непрерывная проверка.** Всегда запускайте скрипт верификации `./scripts/verify.sh` перед созданием коммита. Это не рекомендация, а требование.
*   **A9: Безопасность по умолчанию.** Приложение должно быть безопасным в своей конфигурации по умолчанию.
*   **A10: Контроль версий всего.** Весь код, документация (например, в `/docs`) и данный файл (`AGENTS.md`) находятся под управлением Git.

## 3. Цикл Рабочего Процесса и Правила Взаимодействия

### 3.1. Общий Цикл
Для каждого изменения необходимо строго следовать этому циклу:
**ИССЛЕДОВАНИЕ → ПЛАНИРОВАНИЕ → ДЕЙСТВИЕ → НАБЛЮДЕНИЕ → РАЗМЫШЛЕНИЕ → ВЕРИФИКАЦИЯ → КОММИТ**

### 3.2. Работа с Git
*   **Работайте в отдельных ветках.** Имя ветки должно отражать суть задачи (например, `feature/new-auth-flow`, `fix/user-login-bug`).
*   **Коммитьте свои изменения.** Используйте `git commit` для фиксации атомарных изменений. Оцениваться будет только закоммиченный код.
*   **Исправляйте ошибки pre-commit.** Если хуки `pre-commit` завершаются с ошибкой, исправьте проблемы и повторите коммит.
*   **Поддерживайте чистоту рабочей директории.** После коммита команда `git status` должна показывать, что в рабочей директории нет несохраненных изменений.
*   **Не изменяйте существующие коммиты.** Использование `git commit --amend` или `git rebase` запрещено для обеспечения прозрачности истории.

### 3.3. Интерпретация `AGENTS.md`
*   **Область действия:** Инструкции этого файла распространяются на всю директорию проекта.
*   **Приоритет:** Инструкции от пользователя (в промпте) имеют наивысший приоритет над этим файлом, *если они не нарушают Аксиомы*.
*   **Обязательные проверки:** Если этот файл содержит инструкции по программным проверкам (например, запуск `./scripts/verify.sh`), вы ОБЯЗАНЫ запустить их все и убедиться в их успешном прохождении ПОСЛЕ внесения всех изменений и ПЕРЕД коммитом.

### 3.4. Цитирование
Вы должны добавлять цитаты к своему финальному отчету (например, в описании Pull Request), ссылаясь на использованные файлы или выводы терминала. Это необходимо для обеспечения полной прозрачности и отслеживаемости ваших действий.

*   **Формат для файлов:** `【F:<file_path>†L<line_start>(-L<line_end>)?】`
    *   *Пример:* Этот код инициализирует веб-сервер【F:src/app.py†L15】.
*   **Формат для терминала:** `【<terminal_output_id>†L<line_start>(-L<line_end>)?】`
    *   *Пример:* Все тесты успешно пройдены【terminal_output_1†L5-L7】.

## 4. Настройка и Исследование Среды

### 4.1. Настройка Среды Выполнения (Python/Docker)
1.  **Определите основной язык:** Python. Файл зависимостей — `requirements.txt`.
2.  **Настройте переменные окружения:** Скопируйте `cp .env.example .env` и внесите необходимые значения. Секреты не должны попадать в Git.
3.  **Запустите среду:** Проект полностью контейнеризован. Используйте `docker-compose -f docker/docker-compose.yml up --build` для запуска.

### 4.2. Исследование (Выполнить до Планирования)
1.  **Инвентаризация:** Используйте `tree` для рекурсивного обзора структуры файлов.
2.  **Поиск точек входа:** Найдите маршруты API с помощью `rg --type py '@app.route' src/`.
3.  **Анализ тестов:** Ознакомьтесь с существующими тестами через `rg --type py 'def test_' tests/`.
4.  **Архитектурные документы:** Изучите `docker-compose.yml`, `Dockerfile` и любые документы в директории `@docs/` или `docs/`, так как они определяют контракты и архитектуру.
5.  **Стиль кода:** Проанализируйте существующий код, чтобы понять стиль форматирования, соглашения об именовании и используемые паттерны. Ваши изменения должны быть неотличимы от остального кода.

## 5. Контрольный Список Верификации (Обязательная Проверка)

Перед каждым коммитом выполните эту обязательную программную проверку. Если файла `./scripts/verify.sh` не существует, создайте его с содержимым ниже.

**Код для `./scripts/verify.sh`:**
```bash
#!/bin/bash
# Выход при первой ошибке для гарантии полной проверки.
set -e

echo "--- [1/3] Проверка форматирования кода с помощью black ---"
black --check .

echo "--- [2/3] Проверка линтером с помощью flake8 ---"
flake8 .

echo "--- [3/3] Запуск тестов с помощью pytest ---"
pytest

echo "--- ВЕРИФИКАЦИЯ УСПЕШНО ПРОЙДЕНА ---"
```

*Если скрипт еще не является исполняемым, выполните: `chmod +x ./scripts/verify.sh`*

**Запустите полную проверку:**
```bash
./scripts/verify.sh
```

**Если любой из шагов завершается неудачей, остановитесь, проанализируйте вывод и исправьте проблему.** Успешное выполнение этого скрипта является обязательным и единственным приемлемым результатом перед коммитом.